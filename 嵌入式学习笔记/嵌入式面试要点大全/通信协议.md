串口通信  232  485
总线通信 can  i2c  spi  MODEBUs

目录 i2c  SPI   232  485 can

   概述
UART：(Universal Asynchronous Receiver Transmitter：通用异步收发器/异步串行通信口)，是一种通用的串行数据总线，用于异步通信，支持全双工。它包括了RS232、RS499、RS423、RS422和RS485等接口标准规范和总线标准规范，即UART是异步串行通信口的总称。
IIC总线协议：I2C总线是由Philips公司开发的一种简单、双向二线制同步串行总线。它只需要两根线即可在连接于总线上的器件之间传送信息。
SPI总线协议：SPI是串行外设接口（Serial Peripheral Interface）的缩写。SPI，是一种高速的，全双工，同步的通信总线，并且在芯片的管脚上只占用四根线，节约了芯片的管脚，同时为PCB的布局上节省空间，提供方便，正是出于这种简单易用的特性，如今越来越多的芯片集成了这种通信协议。
RS232接口缺陷:
        (1)接口的信号电平值较高( +/-12V)，易损坏接口电路的芯片。
        (2)传输速率较低，在异步传输时，波特率为20Kbps。
        (3)接口使用一根信号线和一根信号返回线而构成共地的传输形式，这种共地传输容易产生共模干扰，所以抗噪声干扰性弱。
        (4)传输距离有限，最大传输距离标准值为50英尺，实际上也只能用在50米左右。
RS485是对RS232的改进，特点包括:
        ①接口电平低，不易损坏芯片。RS485的电气特性:逻辑“1”以两线间的电压差为+(2 ~ 6)V表示，逻辑“0”以两线间的电压差为-(2~6)V表示。接口信号电平比RS232降低了，不易损坏接口电路的芯片。
        ②传输速率高。10米时，RS485的数据最高传输速率可达35Mbps，在1200m时，传输速度可达100Kbps。
        ③抗干扰能力强。RS485接口是采用平衡驱动器和差分接收器的组合，抗共模干扰能力增强，即抗噪声干扰性好。
        ④传输距离远，支持节点多。RS485总线最长可以传输1200m以上(速率≤100Kbps)一般最大支持32个节点，如果使用特制的485芯片，可以达到128个或者256个节点，最大的可以支持到400个节点。

        CAN总线通信系统是串行通信的一种，要优于RS485总线，是目前比较常用的一种工业总线，如汽车的电气部分就采用CAN总线实现通信。





正文
参考链接本文链接：https://blog.csdn.net/thisway_diy/article/details/116933937
####i2c协议  详细讲解###
SDA  是双向串行数据线
SCL  是串行时钟线
SDA线上的数据必须在时钟的高电平周期保持稳定，数据线的高或低电平状态只有在 SCL 线的时钟信号是低电平时才能改变。换言之，SCL为高电平时表示有效数据，SDA为高电平表示“1”，低电平表示“0”；SCL为低电平时表示无效数据，此时SDA会进行电平切换，为下次数据表示做准备
时钟脉冲宽度  也就是常用的i2c_delay();决定，一般来讲我设置的是5us  这个可以根据不同模块的要求进行设置，

开始信号和结束信号
I²C起始信号（S）：当SCL高电平时，SDA由高电平向低电平转换；
I²C停止信号（P）：当SCL高电平时，SDA由低电平向高电平转换；

应答信号
I²C每次传输的8位数据，每次传输后需要从机反馈一个应答位，以确认从机是否正常接收了数据。当主机发送了8位数据后，会再产生一个时钟，此时主机放开SDA的控制，读取SDA电平，在上拉电阻的影响下，此时SDA默认为高，必须从机拉低，以确认收到数据。


I²C完整传输流程如下：
1 SDA和SCL开始都为高，然后主机将SDA拉低，表示开始信号；

2 在接下来的8个时间周期里，主机控制SDA的高低，发送从机地址。其中第8位如果为0，表示接下来是写操作，即主机传输数据给从机；如果为1，表示接下来是读操作，即从机传输数据给主机；另外，数据传输是从最高位到最低位，因此传输方式为MSB（Most Significant Bit）。

3 总线中对应从机地址的设备，发出应答信号；

4 在接下来的8个时间周期里，如果是写操作，则主机控制SDA的高低；如果是读操作，则从机控制SDA的高低；

5 每次传输完成，接收数据的设备，都发出应答信号； 
6 最后，在SCL为高时，主机由低拉高SDA，表示停止信号，整个传输结束；




本文链接：https://blog.csdn.net/m0_38106923/article/details/123673285

基本特点概况，连接在总线上的器件都有唯一的地址，任何器件都可以作为主机和从机，但是同一时刻只允许一个主机
没有波特率，I2C是真正的多主设备总线，可提供仲裁和冲突检测；
传输速度分为四种模式：
标准模式（Standard Mode）：100 Kbps
快速模式（Fast Mode）：400 Kbps
高速模式（High speed mode）：3.4 Mbps
超快速模式（Ultra fast mode）：5 Mbps

I2C 总线内部使用漏极开路输出驱动器，因此 SDA和 SCL 可以被拉低为低电平，但是不能被驱动为高电平，所以每条线上都要使用一个上拉电阻，默认情况下将其保持在高电平。电阻可选为根据公式计算的
5v电源 1.5千欧姆
3.3电源 967欧姆
一般来讲5k欧姆都是ok的


完整过程就是 开始 结束  地址传送  数据传送
一个字节后面一个应答位

总线仲裁不做具体说明 详细了解
工作过程
第一步 起始条件
第二步 发送设备地址
第三步 接受应答
第四步 收发数据
第五步 接受应答
第六步 停止通信


题外话:关于微秒级定时器的一些小看法，首先毫秒级定时器是通过分频计数的，那么只要检测毫米级的计数值就可以实现微秒级定时






spi协议 4种工作模式
快速理解：高速 全双工  应用EEPROM FLASH ADC DAC
引脚定义
SCLK  串行时钟信号，由主设备产生
MOSI  主机输出从机输入信号（数据主机发）
MISO  主机输入从机输出信号（数据从机发）
CS/SS 片选信号，由主机发出，一般是低电位有效

连接方式不难看出为 时钟对时钟 cs/ssy一般直接确定为低sid对应so  so对应si

详细理解内部协议
在SPI通信中，SPI主机设备以从机设备支持的频率通过SCLK线同步，换言之从机无法主动发送消息，在多从情况下，只能由主机轮询从机（一般不会这么问，只要搞清楚基本的spi通信逻辑就行）

在SPI每个时钟周期内，都会进行一次全双工数据的传输，主机通过MOSI线发送1bit时，从机也会通过MISO发送1bit数据，这说明，即使只进行单工通信，也会保持此通信顺利

简略说明spi通信流程
1 主机首先拉低SS或者CS,以此告知SPI从机通信开始
2 主机通过发送SCLK时钟信号，来告知从机即将进行的读写操作，这里的SCLK时钟信号是由SPI的模式来决定是高电平还是低电平有效的，这点在稍后会进行介绍
3 主机将要发送的数据 写到  数据缓存区 缓存区经过移位寄存器  串行移位寄存器通过MOSI信号线将字节一位一位地去发送给从机，同时数据会从SO口一位一位读取到接受缓存区
4 从机也将自己的串行移位寄存器（0-7）中的内容通过MISO信号线返回给主机，同时通过MOSI信号线接受主机发送的数据，这样，两个，移位寄存器中的内容就被交换


不同的从机可能出厂时就被设置好了  并且无法更改，这点不做详细解释。
但是SPI协议又要求两方必须是同一模式才可以进行，因为此通过时钟极性 和时钟相位 来控制SPI主设备的通信模式就被提出

时钟极性定义了SCLK时钟线在空闲状态时的电平
SCLK 
0 时钟线在空闲状态时的电平为低电平，有效状态为高
1 相反

时钟相位 定义 数据位相对于时钟线的时序 也就是相位
0 表示输出端在上一个时钟周期的后沿改变数据，而输入 (in) 端在时钟周期的前沿(或不久之后)捕获数据。输出端保持数据有效直到当前时钟周期的尾部边缘。对于第一个时钟周期来说，第一位的数据必须在时钟前沿之前出现在 MOSI 线上。也就是一个 CPHA=0 的周期包括半个时钟空闲和半个时钟置位的周期。
1 表示输出 (out) 端在当前时钟周期的前沿改变数据，而输入 (in) 端在时钟周期的后沿(或不久之后)捕获数据。输出端保持数据有效直到下一个时钟周期的前沿。对于最后一个时钟周期来说，从机设备在片选信号消失之前保持 MISO 信号线有效。也就是一个 CHPA=1 的周期包括半个时钟置位和半个时钟空闲的周期。
图像链接 https://img-blog.csdnimg.cn/681cf14cb8694effb280428cda9c9599.png

https://img-blog.csdnimg.cn/48d1042e8f344df7bc18b365a1e3be15.png
比较通俗的解释
SPI 数据的传输是在串行同步时钟信号(Serial Clock,SCK) 的控制下进行的。主机的时钟发生器一方面控制主机的移位寄存器，另一方面通过从机的 SCK 信号线来控制从机的移位寄存器，从而保证主机与从机的数据交换是同步进行的。

SPI 串行同步时钟可以设置为不同的极性(Clock Polarity,CPOL)与相位(Clock Phase,CPHA)。

时钟的极性(CPOL) 用来决定在总线空闲时，同步时钟(SCK)信号线上的电位是高电平还是低电平。当 时钟极性为 0 时(CPOL=0)，SCK 信号线在空闲时为低电平 ； 当时钟极性为 1 时(CPOL=1), SCK 信号线在空闲时为高电平；

时钟的相位(CPHA) 用来决定何时进行信号采样。
当时钟相位为 1 时(CPHA=1), 在 SCK 信号线的第二个跳变沿进行采样； 这里的跳变沿究竟是上升沿还是
下降沿？取决于时钟的极性。当时钟极性为 0 时，取下降沿；当时钟极性为 1 时，取上升沿；如下图：
https://img-blog.csdnimg.cn/b223d614146c4f7692860b565bcdd473.png

SPI通信协议的优缺点
SPI的优点在于它有着比I2C更高的吞吐量，不被最大时钟速度的限制，可实现高速，简单的外设硬件接口，在外围电路上使用的上拉电阻是比I2C少的，这也就意味着功耗更低，从机的时钟来自主机，从机不需要唯一地址，相对于并行接口来说，使用的引脚数更少。
缺点SPI没有内寻址，在使用多个不同模式的从机设备时，主机设备切换模式智能重新初始化，会使得从机设备速度变慢，SPI没有硬件流控，只能通过主机自护地延迟下个时钟周期到来的时间，技能在短距离通信的缺点。





RS232基础知识
计算机与计算机或者计算机与中断之间的数据传输可以通过采用串行和并行通讯，由于串行通信方式具有使用线路少，成本低，特别是在远程传输时，避免了多条线路特性的不一致而被广泛采用
在串行通信时，要求双方采用同一个标准接口，使不同的设备可以更加方便的通信 RS232接口是目前最常用的串行通讯接口
1、电气特性

EIA-RS-232C对电器特性、逻辑电平和各种信号线功能都作了规定。

在TxD和RxD上：逻辑1(MARK)=-3V～-15V ，逻辑0(SPACE)=+3～＋15V 在RTS、CTS、DSR、DTR和DCD等控制线上：

信号有效（接通，ON状态，正电压）＝+3V～+15V

信号无效（断开，OFF状态，负电压)=-3V～-15V

根据设备供电电源的不同，+-5、+-10、+-12和+-15这样的电平都是可能的。
信号的标注是从DTE设备的角度出发的，TD、DTR和RTS信号是由DTE产生的，RD、DSR、CTS、DCD和RI信号是由DCE产生的。

PC 机的RS-232 口为9 芯针插座。一些设备与PC 机连接的RS-232 接口,因为不使用对方的传送控制信号,只需三条接口线,即“发送数据TXD”、“接收数据RXD”和“信号地GND”。



 

双向接口能够只需要3根线制作是因为RS-232的所有信号都共享一个公共接地。非平衡电路使得RS-232非常的容易受两设备间基点电压偏移的影响。对于信号的上升期和下降期，RS-232也只有相对较差的控制能力，很容易发生串话的问题。RS-232被推荐在短距离（15m以内）间通信。由于非对称电路的关系，RS-232接口电缆通常不是由双绞线制作的。
RS-232-C标准规定的数据传输速率为每秒50、75、 100、150、300、600、1200、2400、4800、9600、19200波特，驱动器允许有2500pF的电容负载，通信距离将受此电容限制。


RS-232标准的不足

经过许多年来RS-232 器件以及通信技术的改进，RS-232 的通信距离已经大大增加。由于RS-232 接口标准出现较早，难免有不足之处，主要有以下四点：

（1） 接口的信号电平值较高，易损坏接口电路的芯片，又因为与TTL 电平不兼容故需使用电平转换电路方能与TTL 电路连接。

（2） 传输速率较低，在异步传输时，波特率为20Kbps。现在由于采用新的UART 芯片16C550 等，波特率达到115.2Kbps。

（3） 接口使用一根信号线和一根信号返回线而构成共地的传输形式， 这种共地传输容易产生共模干扰，所以抗噪声干扰性弱。

（4） 传输距离有限，最大传输距离标准值为50 米，实际上也只能用在15米左右。

二、RS485基础知识

针对RS-232串口标准的局限性，人们又提出了RS-422,RS-485接口标准。RS-485/422采用平衡发送和差分接收方式实现通信：发送端将串行口的TTL电平信号转换成差分信号A、B两路输出，经过线缆传输之后在接收端将差分信号还原成TTL电平信号。由于传输线通常使用双绞线，又是差分传输，所以又极强的抗共模干扰的能力，总线收发器灵敏度很高，可以检测到低至200mV电压。故传输信号在千米之外都是可以恢复。

1、RS-485 的电气特性

驱动器能输出±7V的共模电压

接收器的输入电阻RIN≥12kΩ

输入端的电容≤50pF

在节点数为32个，配置了120Ω的终端电阻的情况下，驱动器至少还能输出电压1.5V（终端电阻的大小与所用双绞线的参数有关）

发送端：逻辑"1"以两线间的电压差为+（2 至6） V 表示；逻辑"0"以两线间的电压差为-（2 至6）V 表示。

接收器的输入灵敏度为200mV（即（V+）-（V-）≥0.2V，表示信号"0"；（V+）-（V-）≤-0.2V，表示信号"1"）

2、传输速率与传输距离

RS-485 的数据最高传输速率为10Mbps，最大的通信距离约为1219M，传输速率与传输距离成反比，在10Kb/S的传输速率下，才可以达到最大的通信距离。

但是由于RS-485 常常要与PC 机的RS-232口通信，所以实际上一般最高115.2Kbps。又由于太高的速率会使RS-485 传输距离减小，所以往往为9600bps 左右或以下。

3、网络拓扑

RS-485 接口是采用平衡驱动器和差分接收器的组合，抗共模干能力增强，即抗噪声干扰性好。RS-485采用半双工工作方式，支持多点数据通信。

RS-485总线网络拓扑一般采用终端匹配的总线型结构。即采用一条总线将各个节点串接起来，不支持环形或星型网络。如果需要使用星型结构，就必须使用485中继器或者485集线器才可以。RS-485/422总线一般最大支持32个节点，如果使用特制的485芯片，可以达到128个或者256个节点，最大的可以支持到400个节点。



串口是计算机上一种非常通用设备通信的协议（不要与通用串行总线Universal Serial Bus或者USB混淆）。大多数计算机包含两个基于RS232的串口。串口同时也是仪器仪表设备通用的通信协议；很多GPIB兼容的设备也带有RS-232口。同时，串口通信协议也可以用于获取远程采集设备的数据。

串口通信的概念非常简单，串口按位（bit）发送和接收字节。尽管比按字节（byte）的并行通信慢，但是串口可以在使用一根线发送数据的同时用另一根线接收数据。它很简单并且能够实现远距离通信。比如IEEE488定义并行通行状态时，规定设备线总常不得超过20米，并且任意两个设备间的长度不得超过2米；而对于串口而言，长度可达1200米。

典型地，串口用于ASCII码字符的传输。通信使用3根线完成：（1）地线，（2）发送，（3）接收。由于串口通信是异步的，端口能够在一根线上发送数据同时在另一根线上接收数据。其他线用于握手，但是不是必须的。串口通信最重要的参数是波特率、数据位、停止位和奇偶校验。对于两个进行通行的端口，这些参数必须匹配：

1、波特率

这是一个衡量通信速度的参数。它表示每秒钟传送的bit的个数。例如300波特表示每秒钟发送300个bit。当我们提到时钟周期时，我们就是指波特率例如如果协议需要4800波特率，那么时钟是4800Hz。这意味着串口通信在数据线上的采样率为4800Hz。通常电话线的波特率为14400，28800和36600。波特率可以远远大于这些值，但是波特率和距离成反比。高波特率常常用于放置的很近的仪器间的通信，典型的例子就是GPIB设备的通信。

2、数据位

这是衡量通信中实际数据位的参数。当计算机发送一个信息包，实际的数据不会是8位的，标准的值是5、7和8位。如何设置取决于你想传送的信息。比如，标准的ASCII码是0～127（7位）。扩展的ASCII码是0～255（8位）。如果数据使用简单的文本（标准 ASCII码），那么每个数据包使用7位数据。每个包是指一个字节，包括开始/停止位，数据位和奇偶校验位。由于实际数据位取决于通信协议的选取，术语“包”指任何通信的情况。

3、停止位

用于表示单个包的最后一位。典型的值为1，1.5和2位。由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。

4、奇偶校验位

在串口通信中一种简单的检错方式。有四种检错方式：偶、奇、高和低。当然没有校验位也是可以的。对于偶和奇校验的情况，串口会设置校验位（数据位后面的一位），用一个值确保传输的数据有偶个或者奇个逻辑高位。例如，如果数据是011，那么对于偶校验，校验位为0，保证逻辑高的位数是偶数个。如果是奇校验，校验位位1，这样就有3个逻辑高位。高位和低位不真正的检查数据，简单置位逻辑高或者逻辑低校验。这样使得接收设备能够知道一个位的状态，有机会判断是否有噪声干扰了通信或者是否传输和接收数据是否不同步。

二、握手基础知识

RS-232通行方式允许简单连接三线：Tx、Rx和地线。但是对于数据传输，双方必须对数据定时采用使用相同的波特率。尽管这种方法对于大多数应用已经足够，但是对于接收方过载的情况这种使用受到限制。这时需要串口的握手功能。在这一部分，我们讨论三种最常用的RS-232握手形式：软件握手、硬件握手和Xmodem。

1、软件握手

我们讨论的第一种握手是软件握手。通常用在实际数据是控制字符的情况，类似于GPIB使用命令字符串的方式。必须的线仍然是三根：Tx、Rx和地线，因为控制字符在传输线上和普通字符没有区别，函数SetXModem允许用户使能或者禁止用户使用两个控制字符XON和OXFF。这些字符在通信中由接收方发送，使发送方暂停。

、硬件握手

第二种是使用硬件线握手。和Tx和Rx线一样，RTS/CTS和DTR/DSR一起工作，一个作为输出，另一个作为输入。第一组线是RTS （Request to Send）和CTS（Clear to Send）。当接收方准备好接收数据，它置高RTS线表示它准备好了，如果发送方也就绪，它置高CTS，表示它即将发送数据。另一组线是DTR（Data Terminal Ready）和DSR（Data Set Ready）。这些现主要用于Modem通信。使得串口和Modem通信他们的状态。例如：当Modem已经准备好接收来自PC的数据，它置高DTR线，表示和电话线的连接已经建立。读取DSR线置高，PC机开始发送数据。一个简单的规则是DTR/DSR用于表示系统通信就绪，而RTS/CTS用于单个数据包的传输。


我经常问某些产品推广人员，“您设备的通讯协议是什么”，他回答：“232”或是“485”。今天您看了上面这些大白话，请您就不要再这样回答了。
Modbus通信标准协议可以通过各种传输方式传播，如 RS232C、RS485、光纤、无线电等。
“232”或是“485”只是一种线路传输方式，与协议是无关的！232传输抗干扰性差，485传输抗干扰相对强。

MODBUS做为一种标准的协议，应用于各种PLC，控制器，仪表。这些仪表或是控制器应用中，元件的通讯地址肯定是不一样了；各个命令码的各部分组成的意义也许也会不同；
但是，它一定会遵守MODBUS的协议规范。即，每个命令码的组成一定符合MODBUS的规范！一样不多，一样不少！






can协议
CAN一般用于车机 本身就是为大型货车和重工机械设计的

CAN总线通信系统是串行通信的一种，要优于RS485总线，是目前比较常用的一种工业总线，如汽车的电气部分就采用CAN总线实现通信。

 与I2C、SPI等具有时钟信号的同步通讯方式不同，CAN通讯并不是以时钟信号来进行同步的，它是一种异步半双工通讯。（同步即在同一个时钟驱动下数据通信，半双工即接受与发送不能同时进行）


CAN协议经过ISO标准化后有两个标准ISO11898标准和IS011519-2标准。其中ISO11898是针对通信速率为125Kbps~1Mbps的高速通信标准（闭环），而IS011519-2是针对通信速率为125Kbps以下的低速通信标准（开环）。

Kbps：总线的通信速率，指的是位速率。或称为比特率（和波特率不是一回事），表示的是：单位时间内，通信线路上传输的二进制位的数量，其基本单位是 bps 或者 b/s (bit per second)。

CAN的组成一般有两种方式：

                1：CPU与CAN控制器集成到一起、再外接CAN收发器；

                2：另一种是CPU与CAN控制器分开的，使用的时候需要配置CAN接口电路，比较麻烦。

        STM32中就是采用第一种方式，将CAN接口集成在芯片内，使用的时候再外接CAN收发器（顾名思义，可发送，可接收），常用的有TJA1050或者82C250。
实际上CAN通信是通过两根线完成的 CAN_High  CAN_low

按照定义：

CAN_High - CAN_Low < 0.5V 时候为隐性的，逻辑信号表现为"逻辑1"，即高电平。

CAN_High - CAN_Low > 0.9V 时候为显性的，逻辑信号表现为"逻辑0"，即低电平。


 一次数据传输的例子

  比如总线上有3个节点，节点1设置ID为000100 00110，节点2设置ID为000100 00111，节点3验收滤波ID表中有节点1和节点2的ID号，节点1和节点2同时向节点3发送1字节的信息。

总线空闲，节点1和节点2同时发送帧起始信号，3个节点同时调整位时序（硬同步）；
节点1和节点2开始仲裁，两者同时向总线发送第一位0，同时回读总线状态与本身状态相与，得0，两者第1位仲裁均通过；一直持续到第9位1，两者同时向总线发送1，同时回读总线状态，得1，两者第9位仲裁均通过；
直到第11位，当两个节点回读总线状态与本身状态相与时，总线得显性将隐性屏蔽，即总线状态为显性，则节点1得0（与本身状态相同），而节点2得0（与本身状态不同），此时节点1仲裁胜利，节点2放弃发送请求；
从第1位仲裁到第11位仲裁得同时，节点1向其他节点广播了本身的ID，当然节点1本身也接收到节点2的ID信息，因此节点2和节点3也都收到了节点1的ID信息，只不过节点2对节点1不敢兴趣，因而选择了忽略节点1后续的信息，节点3则开始接收节点1的数据；
从硬同步之后，每当节点1和节点2发出一个仲裁位，三个节点的CAN控制器都在检测本身的位时序与总线位时序是否一致，当有相位超前或者滞后时则自动进行位时序的重新同步。在后续的报文传送中亦是如此。


























具体就不再赘述了，一般来讲基础面试部分只会问很少的一部分，笔试题的选择笔者也不乏见到如从下面的接口中选择不是SPI接口的选择题。当然您要是觉得远远不够，可以自行百度了解。

如有疏漏深感抱歉，请自主添加注解。
